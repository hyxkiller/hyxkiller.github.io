---
title: 引入谷歌统计
date: 2019-02-20 23:44:04
tags: flutter
---

## 如何加入谷歌统计
1. 创建或登录到您的 Google Analytics帐号( google.com/analytics)
2. 在 Google Analytics（分析）帐号中设置媒体资源。媒体资源代表您的网站或应用。  
    **如何设置媒体资源？**
    + 登录到谷歌分析后，点击左下角管理，在“帐号”列(第一列)中，来选择要向其添加媒体资源的帐号。如果有多个帐号，可使用搜索框找到所需的帐号。
    + 在“媒体资源”列(第二列)中，点击创建新媒体资源。如果您对相应帐号没有“修改”权限，则看不到创建新媒体资源选项。请检查您是否已 从“帐号”列中选择了正确的帐号。
    + 选择网站或移动应用。如果您选择网站，请跳至第 5 步。如果您选择移动应用，请继续执行第 4 步。
    + （移动应用）在“跟踪方法”下，选择 Firebase。从菜单中选择一个应用，然后点击关联应用。
    + 输入网站名称或应用名称。如果打算在帐号中跟踪多个应用，请使用非常具体的描述性名称，并在其中包含版本号。方便日后管理。（仅限网站）输入网站网址。如果网址的格式不正确，就无法创建媒体资源。
    + 选择行业类别。
    + 选择报告时区。此时区将用作报告的每日起止时间，而无论数据来自何处。
    + 点击获取跟踪 ID。
3. 在您的媒体资源中设置报告数据视图。数据视图支持显示网站的某一部分跟踪数据，过滤掉其他不重要部分的数据。没有创建视图默认是全部网站数据。
4. 按照说明将跟踪代码添加到您的网站或移动应用。
    **如何查找跟踪ID？**
    + 登录到您的 Google Analytics（分析）帐号
    + 点击左下角管理
    + 从“帐号”列的菜单中选择一个帐号。
    + 从“媒体资源”列的菜单中选择一个媒体资源。
    + 在“媒体资源”下，点击跟踪信息 > 跟踪代码。跟踪 ID 会显示在页面的顶部。     
+ 跟踪代码段 将以下代码段粘贴到网站的每个网页的 <head> 标记之后，并且紧挨着该标记放置。将 GA_TRACKING_ID 替换为您自己的 Google Analytics（分析）跟踪 ID：
```
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_TRACKING_ID"></script>
 <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
 
   gtag('config', 'GA_TRACKING_ID');
 </script>
```
+ 验证跟踪代码是否正常工作 要验证跟踪代码是否正常工作，请访问您的网站，并检查您的这次访问是否已在实时报告(在左侧面板中，打开实时类别下的概览。)中记录。

## 设置事件跟踪
1. 设置时间目标
    + 登录到您的 Google Analytics（分析）帐号 点击左下角管理
    + 从“帐号”列的菜单中选择一个帐号。
    + 从“媒体资源”列的菜单中选择一个媒体资源。 从“数据视图”列的菜单中选择一个数据视图。
    + 点击目标>自定义按钮>继续，填写名称(最好是你自己可以区分的，有意义的名字例如：打赏按钮)，点击类型下的事件>继续>填写类别、操作、标签和价值(可选)>保存即可。
2. 设置事件跟踪     
在你的网页添加如下类似的代码：
```
<a onClick="ga('send', 'event', '你填写的类别', '你填写的操作', '你填写的标签','你填写的价值');" href="打赏链接" target="_blank”>打赏</a>
```
3. 查看事件追踪报告 左侧面板实时>事件即可查看
 
## 设置异常跟踪
在您的网站添加如下代码：
```
ga('send', 'exception', [fieldsObject]);
```
例如: 
```
try {
  // Runs code that may or may not work.
  ....
} catch(err) {
  ga('send', 'exception', {
    'exDescription': err.message,//可选 标识对异常的说明。
    'exFatal': false,//可选 true 表示异常属于严重类型。
  });
}
```

## 用户识别
通过**User ID**进行用户身份识别     
**注意**:USER_ID 值应是一个独一无二的永久性非个人身份字符串，在所有设备上代表对应的用户或已登录帐户。
1. 如果userId是已知的，可以直接获取到，则只需添加如下代码即可：
```
ga('create', 'UA-XXXXX-Y', 'auto', {
    userId: USER_ID
});
```
2. 如果userId是未知的，需要调用接口才能获取到，那么在获取到userId后执行如下代码：
```
ga('set', 'userId', USER_ID);
```
添加该段代码后必须再设置一个事件向谷歌统计发送数据（参考谷歌统计之设置事件跟踪文章），例如：
```
ga('send', 'event', 'authentication', 'user-id available');
```

## 停用谷歌统计
在网站添加如下代码
```
window['ga-disable-UA-XXXXX-Y'] = true;
```
其中的值 UA-XXXXX-Y对应于您要停止跟踪的媒体资源 ID。