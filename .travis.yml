language: node_js
node_js: stable
branches:
  only:
  - source
cache:
  directories:
  - node_modules
addons:
  ssh_known_hosts: 39.97.40.43
before_deploy: 
  - openssl aes-256-cbc -K $encrypted_383bc2ea2d21_key -iv $encrypted_383bc2ea2d21_iv -in deploy_rsa.enc -out /tmp/deploy_rsa -d
  - eval "$(ssh-agent -s)"
  - chmod 600 /tmp/deploy_rsa
  - ssh-add /tmp/deploy_rsa
before_install:
# - openssl aes-256-cbc -K $encrypted_c8bcf74436a5_key -iv $encrypted_c8bcf74436a5_iv
#   -in travis_rsa.pub.enc -out travis_rsa.pub -d
# - chmod 600 travis_rsa.pub
- echo -e "Host http://39.97.40.43\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
- export TZ='Asia/Shanghai'
- npm install hexo-cli -g
- chmod +x ./publish.sh
- sudo apt-get update
install:
- npm install
- sudo apt-get install sshpass
script:
- hexo clean
- hexo g
# deploy:
#   provider: script
#   skip_cleanup: true
#   script: rsync -r --delete-after --quiet $TRAVIS_BUILD_DIR/public root@39.97.40.43:/usr/local/nginx/public
#   on:
#     branch: master
after_success:
- export SSHPASS=$DEPLOY_PASS
- ./publish.sh
- sshpass -e ssh  -o stricthostkeychecking=no root@39.97.40.43 sh ./deploy-to-vps.sh
# - ./deploy-to-vps.sh

env:
  global:
  - GH_REF: github.com/hyxkiller/hyxkiller.github.io.git
  - secure: "iCP7vGPH1en8XcjsDDJzDB8XSRHTOqPyiHkuDO0cyRUVavfWSKKsjf/9pHssXZI9oS0pplqOG/hj8kbrNbAnKLCHYPPTzAVz2IfPIwlUT1fUQOjRICx+/+ZRRbDEAtfT7gQVMbyXxzBZSAzILwZyPlV7Tzvc2CfFbiitbwQfY6erSbhYGnVL+pM/81jG4QwUp545tRdEqeWoOgjOl+u3QtpKLx4Lr7PUhkCDQrkZHefjk/OWdpnoVAjgD+ms1JcDdz9f6JtBm7raAnjx6jvqUIfEDweEhMP1GPFSXSgpqbOw/mZZmxzgGioZHhF9HOcVvnBbcNGvNDPGL0IUvWPVmTkR1lD0GMxsnbedTQ/tttUOYBWrPKVk7DZM2FYEzFKdTnw3BlnRZaYtszpjixWCsz1tX1qgN64In1T8kR8EjC9GK+sxQvRAlxT1MAYJdZsQ+wiENsy0TGEmNdkGBZt3r/ov4d/fC32GDESvQ7VBmlrP8fmp/hzoyZQeWB/yk+tLg/HmEmODQ3DwYN+CM/ushMbif34QKrT8wij5kWg7LwGeepeXjbpvgJITrgbAT8mP0eDh4PZcoqddaHVbGLYpdkmk0BupmNyJgsYQrcRHGML2ZvGoDeuv3Ab3cl5kwO2T79EqlXF4buFKoRh2upWGSMLNxGf6gaCb137I8dulET0="
  - secure: "SgYA8a1SwWxcP2Lwn3T0TwuToXwUvNuTjAKgjKYqJwEgrsJyKdcugeH57lwNFIYIOJK91njScvCZ4+Oym6ScsjmPopM13lYMZzcnxySR5s6VtGx3t7d4/AMG9gbEQnBGwaIqt8BMrHIMXnkzK0/xDYep513rOKx3K8FKAbXIiCQY8gpolpNug9dxTl6vgILEYwBijq5oW6ZDnl8UV4dPw6gtKkHK7JH2VsQZnb/RpArfBXKO6MxiODoMuAmJiv/mIoIVp2V9jXfr5uvr6osmwwOJ8ibVxvVPhg+lirHNmNqrSZtPVBxmI61cx8dNEZuvjGBwvj8YryXWXolRKIgXI+V80Rl8II2SIKHk4YtKtd6vuQbrAdl7yf3SleupLjKs3jAxU+AL83sBwSwcZuH0i0BCPsjNQ8euA8QJ0f4VBzGxPb7ILpLS8L1WQPylUjQyaMyotPSlFXwLQrl7KWV0j878xOsMtu7a3mMBkHOwgdMH4oncrUCMOg4DoncE1TdUi1peeQ/g44LRObmr0K0YYSdviplIPYisuiZxatAxa2v1+XpidIJjXdIs4h6g5g2B8S3TzHtIlrAqK8S1ccgmhpNXSe0ILLRzkxfpQpGim1C5h7aU+/dFIvY6RkAxx3jsQRF/CZzQaiQYIFCdO565VrIkgMisDkFd0UA0NAbtxKA="
